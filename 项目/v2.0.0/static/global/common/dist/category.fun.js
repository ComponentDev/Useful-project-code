define("static/global/common/2.0.0/category.fun",["static/global/common/2.0.0/dialog","static/global/common/2.0.0/slider","static/global/common/2.0.0/common.fun"],function(a,b,c){var d={};a("static/global/common/2.0.0/dialog.js")($),a("static/global/common/2.0.0/slider.js")($);var e=a("static/global/common/2.0.0/common.fun.js"),f="http://www.xidibuy.com";d.Datas={isExist:!0,insertGid:0,goodsInfo:{},goodsList:{},attrList:{},isFavorite:{},addCartSuccess:function(a){var b=null;a.attr("data-disabled","disabled").html("已加入购物车"),b=setTimeout(function(){clearTimeout(b),a.removeAttr("data-disabled").html("<em></em>加入购物车")},2e3)},addCartFaild:function(a){var b='<p style="font-size: 16px;">'+a+"</p>",c=null;$.dialog_block({title:" ",content:b}),c=setTimeout(function(){clearTimeout(c),$.dialog_unblock()},2e3)}},d.Actions={getBaseGoodsInfo:function(a,b){$.ajax({type:"GET",url:f+"/detail/getBaseGoodsInfo",data:a,dataType:"json",success:function(a){var a="string"==typeof a?$.parseJSON(a):a,c=a.data;0==a.code&&b&&b(c)},error:function(){}})},getGoodsInfo:function(a,b){var c=a.attr("data-product-id");$.ajax({type:"POST",url:f+"/detail/get?id="+c+"&jsoncallback=?",dataType:"json",async:!1,success:function(e){var e="string"==typeof e?$.parseJSON(e):e;d.Datas.goodsInfo[c]=e,0==e.code&&(d.Datas.isFavorite[c]=d.Datas.goodsInfo[c].data[c].isFavourite,d.Datas.goodsList[c]=d.Datas.goodsInfo[c].data[c].goodList,d.Datas.attrList[c]=d.Datas.goodsInfo[c].data[c].attrList,b&&b(a,d.Datas.attrList[c])),d.Methods.setAddCartButtonState(c),d.Methods.setGoodsFavoriteState(c)},error:function(){}})},insertCart:function(a,b){var c=a.attr("data-product-id"),g=a.attr("data-product-num"),h={};h.productId='{"'+c+'":'+g+"}",$.ajax({type:"GET",url:f+"/Cart/add?productId="+h.productId+"&jsoncallback=?",dataType:"json",async:!1,success:function(c){var c="string"==typeof c?$.parseJSON(c):c;e.Actions.getCartNum(),0==c.code&&b&&b(a)},error:function(){d.Datas.addCartFaild("添加购物车失败！")}})},productCollect:function(a,b){var c=a.attr("data-product-id"),e=a.attr("data-product-sn"),g=b?"/Favourite/productAdd":"/Favourite/productCancel",h={};h.prodSn=e,$.ajax({type:"POST",url:f+g,data:h,success:function(a){var a="string"==typeof a?$.parseJSON(a):a;0==a.code&&d.Methods.setGoodsFavoriteState(c)},error:function(){}})},favoriteCollect:function(a,b){var c=a.attr("data-product-id"),e=b?"/Favourite/favouriteAdd":"/Favourite/favouriteCancel",g={};g.id=c,$.ajax({type:"POST",url:f+e,data:g,success:function(a){var a="string"==typeof a?$.parseJSON(a):a;0==a.code&&d.Methods.setGoodsFavoriteState(c)},error:function(){}})}},d.Methods={initGoodsInfo:function(a){d.Methods.selectSetGoods(a)},selectSetGoods:function(a){var a="string"==typeof a?$(a):a,b={},c=[];a.each(function(){var a=$(this),b=a.attr("data-goodsInfo-id");c.push(b)}),b.ids=c.join(","),d.Actions.getBaseGoodsInfo(b,d.Methods.setBaseGoodsInfo)},setBaseGoodsInfo:function(a){for(var b in a){var c=a[b].editTime,d=a[b].price;d="¥"+d;var e=$("[data-class=category][data-goodsInfo-id="+b+"]"),f=$("[data-class=goodsEditTime][data-goodsInfo-id="+b+"]");e[0]&&e.text(d),f[0]&&f.text(c)}},isGetGoodsInfo:function(a,b){var c=a.attr("data-product-id");"undefined"==typeof d.Datas.goodsInfo[c]?d.Actions.getGoodsInfo(a,b):(b&&b(a,d.Datas.attrList[c]),d.Methods.setAddCartButtonState(c))},setAddCartButtonState:function(a,b){var c=$(".products-outer[data-product-id="+a+"] .add-cart-button"),e=b?b:a;"undefined"==typeof d.Datas.goodsList[a]?(c.html("商品不存在"),c.addClass("button-disabled")):d.Datas.goodsList[a][e].stockNum<1?(c.html("缺货登记"),c.addClass("button-disabled")):(c.html("<em></em>加入购物车"),c.removeClass("button-disabled")),b&&c.attr("data-product-id",b)},setGoodsFavoriteState:function(a){var b=d.Datas.isFavorite[a],c=$('[data-product-id="'+a+'"] [data-class="favorite"]');b?(d.Datas.isFavorite[a]=0,c.addClass("icon-favorite").removeClass("icon-unfavorite")):(d.Datas.isFavorite[a]=1,c.addClass("icon-unfavorite").removeClass("icon-favorite"))},getSelectedAttr:function(a){var b=a.attr("data-class"),c="list"==b?"products-attr-select":"detail-goods-attr-select",d=$("."+c,a),e=[],f="";return d.each(function(){var a=$(this).attr("data-product-attr");e.push(a)}),f=e.sort().join(", ")},connectGoodsAttr:function(a){function b(a){var b=[],c="";for(var d in a)b.push(d);return c=b.sort().join(", ")}var c=d.Datas.goodsList[a],e={};for(var f in c){var g=c[f].priceAttr;e[f]=b(g)}return e},getId:function(a,b){var c=d.Methods.connectGoodsAttr(a),e=0;for(var f in c)b==c[f]&&(e=f);return e},getGoodsImage:function(a,b){a.attr("data-product-id"),$(".products-image",a);var c=$(".products-image-list",a);$(".products-image-control",a);var d=$("img",c),e=d.width(),f=d.height(),g=d.parent(),h=g.attr("data-product-attr"),i="",j=0;if(d.length>1)return!1;for(var j in b)if("颜色"==b[j].name)var k=b[j].colorimg;for(var l in k)l!=h&&d.length<2&&(i+='<a href="" data-product-attr="'+l+'" style="position:absolute; left:'+e+'px;"><img src="http://image.xidibuy.com/'+k[l]+'" width="'+e+'" height="'+f+'"></a>',j++);j&&(c.append(i),a.slider({autoPlay:!1,duration:400,callback:function(b){var c=b.attr("data-product-attr");a.find(".products-attr-val-list").eq(0).find('[data-product-attr="'+c+'"]').click()}}))},isExist:function(a){var b=a.data.shopItem;d.Datas.isExist=!1;for(var c in b){var e=b[c].goodsItem;for(var f in e)if(e[f].goodsId==d.Datas.insertGid){d.Datas.isExist=!0;break}}},isInsertGoods:function(a){return d.Datas.insertGid=a,e.Actions.getSkuGoodsNums(),e.Actions.getCartGoods(d.Methods.isExist),XD.Datas.skuGoodsNums>=XD.Datas.cartMax&&!d.Datas.isExist?(d.Datas.addCartFaild("购物车已满！"),!1):!0}},d.Events={listSelectedAttr:function(a){var b=$(".products-attr-val",a);b.on("click",function(){var b=$(this);if(b.hasClass("products-attr-select"))return!1;b.addClass("products-attr-select").siblings().removeClass("products-attr-select");var c=a.attr("data-product-id"),e=d.Methods.getSelectedAttr(a),f=d.Methods.getId(c,e);d.Methods.setAddCartButtonState(c,f)})},detailSelectedAttr:function(a,b){var a="string"==typeof a?$(a):a,c=$(".detail-goods-attr-val",a),e=c.children("[data-product-attr]");d.Actions.getGoodsInfo(a),e.on("click",function(){var c=$(this);if(c.hasClass("products-attr-select"))return!1;c.addClass("detail-goods-attr-select").siblings().removeClass("detail-goods-attr-select");var e=a.attr("data-product-id"),g=d.Methods.getSelectedAttr(a),h=d.Methods.getId(e,g);location.href="preview"==b?f+"/preview/home?token="+show_token+"&id="+h:f+"/detail/?id="+h})},clickAddCartButton:function(a){var a="string"==typeof a?$(a):a;a.on("click",function(){var a=$(this),b=a.hasClass("button-disabled"),c=a.attr("data-disabled");if(b||"disabled"==c)return!1;var e=a.attr("data-product-id");return d.Methods.isInsertGoods(e)&&d.Actions.insertCart(a,d.Datas.addCartSuccess),!1})},clickFavoriteButton:function(a,b,c){var e="string"==typeof a?$(a):a,f="string"==typeof b?$(b):b;return e.length<1?!1:(e.on("click",function(){var a=$(this),b=a.hasClass("icon-favorite");return b?c?d.Actions.favoriteCollect(f,"addFavorite"):d.Actions.productCollect(f,"addFavorite"):c?d.Actions.favoriteCollect(f):d.Actions.productCollect(f),!1}),void 0)}},c.exports=d});
